name: angle-prep

on:
  workflow_dispatch:

jobs:
  prep:
    runs-on: windows-latest

    steps:
      - name: Checkout (required so workspace exists)
        uses: actions/checkout@v4

      - name: Show workspace
        shell: pwsh
        run: |
          Write-Host "Workspace: $env:GITHUB_WORKSPACE"

      # GH CLI login (correct PowerShell syntax)
      - name: Authenticate gh
        shell: pwsh
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh auth status 2>$null
          if ($LASTEXITCODE -ne 0) {
            Write-Host "Logging into GH CLIâ€¦"
            gh auth login --with-token <<< "$env:GH_TOKEN"
          }
          gh auth status

      # Hardcoded run ID + artifact name
      - name: Download angle-src.tgz from run 19175891700
        shell: pwsh
        run: |
          gh run download 19175891700 --name "angle-src.tgz" --dir "$env:GITHUB_WORKSPACE\work"

      - name: Verify artifact
        shell: pwsh
        run: |
          if (-not (Test-Path "$env:GITHUB_WORKSPACE\work\angle-src.tgz")) {
            throw "Artifact angle-src.tgz not found after download"
          }
          Write-Host "Artifact successfully downloaded:"
          Get-ChildItem "$env:GITHUB_WORKSPACE\work"
