name: angle-prep
on:
  workflow_dispatch: {}   # manual only

jobs:
  prep:
    runs-on: windows-latest
    env:
      ANGLE_RUN_ID: "19175891700"   # hardcoded run ID
      ANGLE_ARTIFACT: "angle-src.tgz"  # hardcoded artifact name
    steps:
      - name: Checkout (for repo context)
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Show workspace and inputs
        shell: pwsh
        run: |
          Write-Host "Workspace: $env:GITHUB_WORKSPACE"
          Write-Host "Run ID: $env:ANGLE_RUN_ID"
          Write-Host "Artifact: $env:ANGLE_ARTIFACT"

      - name: Download artifact from specified run
        uses: actions/download-artifact@v4
        with:
          name: ${{ env.ANGLE_ARTIFACT }}
          path: work
          run-id: ${{ env.ANGLE_RUN_ID }}
          repository: ${{ github.repository }}

      - name: Verify and list
        shell: pwsh
        run: |
          if (-not (Test-Path "work\${env:ANGLE_ARTIFACT}")) {
            throw "Artifact not found at work\${env:ANGLE_ARTIFACT}"
          }
          Write-Host "Downloaded files:"
          Get-ChildItem -Recurse work | ForEach-Object { $_.FullName }
